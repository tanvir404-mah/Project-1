<!-- templates/attendance_summary.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Attendance Summary</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f7f9fc;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #3498db;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background: #3498db;
            color: white;
        }
        .chart-container {
            width: 60%;
            margin: 30px auto;
        }
    </style>
</head>
<body>
    <h1>Attendance Summary</h1>

    <table>
        <thead>
            <tr>
                {% if user.role == "student" %}
                    <th>Subject</th>
                    <th>Total Classes</th>
                    <th>Present</th>
                    <th>Absent</th>
                    <th>Percentage</th>
                {% else %}
                    <th>Student</th>
                    <th>Total Classes</th>
                    <th>Present</th>
                    <th>Absent</th>
                    <th>Percentage</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for record in attendance_data %}
            <tr>
                {% if user.role == "student" %}
                    <td>{{ record.subject }}</td>
                {% else %}
                    <td>{{ record.student }}</td>
                {% endif %}
                <td>{{ record.total }}</td>
                <td>{{ record.present }}</td>
                <td>{{ record.absent }}</td>
                <td>{{ record.percentage }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="chart-container">
        <canvas id="attendanceChart"></canvas>
    </div>

    <script>
        const labels = [
            {% for record in attendance_data %}
                {% if user.role == "student" %}
                    "{{ record.subject }}",
                {% else %}
                    "{{ record.student }}",
                {% endif %}
            {% endfor %}
        ];

        const data = {
            labels: labels,
            datasets: [{
                label: 'Attendance %',
                data: [
                    {% for record in attendance_data %}
                        {{ record.percentage }},
                    {% endfor %}
                ],
                backgroundColor: 'rgba(52, 152, 219, 0.5)',
                borderColor: 'rgba(52, 152, 219, 1)',
                borderWidth: 1
            }]
        };

        const config = {
            type: 'bar',
            data: data,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        };

        const myChart = new Chart(
            document.getElementById('attendanceChart'),
            config
        );
    </script>
</body>
</html>
